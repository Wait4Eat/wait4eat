<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>결제 테스트</title>
    <script src="https://js.tosspayments.com/v1/payment"></script>
</head>
<body>
<h2>결제 테스트</h2>
<button id="payBtn">결제하기</button>

<script>
    // JWT 토큰
    // const token = ;

    document.getElementById("payBtn").addEventListener("click", async function () {
        console.log("[클릭] 결제 요청 시작");

        try {
            const response = await fetch("http://localhost:8080/api/v1/payments/prepare", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                },
                body: JSON.stringify({
                    waitingId: 1,
                    couponId: 1
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error("preparePayment 실패: " + errorText);
            }

            const result = await response.json();
            const data = result.data;

            console.log("prepare 응답:", data);

            if (!data.amount || !data.orderId || !data.customerKey) {
                throw new Error("필수 결제 데이터 누락");
            }

            const toss = TossPayments("test_ck_KNbdOvk5rkOdPmx5Mk72rn07xlzm");

            toss.requestPayment("카드", {
                amount: data.amount,
                orderId: data.orderId,
                orderName: data.shopName + " 예약금",
                customerName: data.customerKey,
                successUrl: "http://localhost:8080/api/v1/payments/success?couponId=1",
                failUrl: "http://localhost:8080/api/v1/payments/fail"
            });

        } catch (err) {
            console.error("결제 요청 오류:", err);
            alert("결제 준비 중 오류: " + err.message);
        }
    });
</script>
</body>
</html>